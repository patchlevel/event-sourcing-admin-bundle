{% extends '@PatchlevelEventSourcingAdmin/layout.html.twig' %}

{% block content %}
    <div class="px-4 sm:px-6 lg:px-8">

        <!-- Headline -->
        <div class="text-2xl font-bold mb-8">
            Inspection
        </div>

        <div class="flex mt-8 gap-4">
            <div class="w-1/2">
                <div class="mb-8">
                    <div class="sm:hidden">
                        <label for="tabs" class="sr-only">Select a tab</label>
                        <!-- Use an "onChange" listener to redirect the user to the selected tab URL. -->
                        <select id="tabs" name="tabs" class="block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm">
                            <option>My Account</option>
                            <option>Company</option>
                            <option selected>Team Members</option>
                            <option>Billing</option>
                        </select>
                    </div>
                    <div class="hidden sm:block">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                <!-- Current: "border-indigo-500 text-indigo-600", Default: "border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700" -->
                                <a href="#" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">Detail</a>
                                <a href="#" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium">Dump</a>
                                <a href="#" class="border-indigo-500 text-indigo-600 whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium" aria-current="page">Serialized</a>
                            </nav>
                        </div>
                    </div>
                </div>

                <dl class="divide-y divide-gray-100">
                    {{ _self.text('ID', aggregateId) }}
                    {{ _self.text('Name', aggregateName) }}
                    {{ _self.text('Class', aggregateClass) }}
                    {{ _self.text('Playhead', aggregate.playhead) }}
                </dl>

                {{ dump(aggregate) }}

                <div class="json">
                    {{~ serializedAggregate ~}}
                </div>
            </div>

            <div class="flow-root w-1/2">
                <ul role="list" class="-mb-8">
                    {% for message in messages %}
                        <li class="group/message">
                            <div class="relative pb-8">
                                <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200"
                                      aria-hidden="true"></span>
                                <div class="relative flex space-x-3">
                                    <div>
                                <span {% if eventsourcing_inspection_color(message.event) %}style="background: {{ eventsourcing_inspection_color(message.event) }};"{% endif %} class="h-8 w-8 rounded-full bg-gray-400 flex items-center justify-center ring-8 ring-white">
                                    {{ heroicon(eventsourcing_inspection_icon(message.event, 'calendar'), 'h-5 w-5 text-white') }}
                                </span>
                                    </div>
                                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                        <div>
                                            <p class="text-sm text-gray-500">
                                                {{ eventsourcing_inspection_description(message.event, eventsourcing_event_name(message)) }}
                                                <a href="#"
                                                   class="text-gray-500 hover:text-gray-900 invisible group-hover/message:visible"
                                                   data-modal="modal-{{ loop.index }}">
                                                    {{ heroicon('magnifying-glass', 'h-5 w-5 inline') }}
                                                </a>
                                            </p>
                                            <dialog id="modal-{{ loop.index }}"
                                                    class="relative text-left rounded p-8 w-3/4">
                                                <form method="dialog" class="text-right static right-0">
                                                    <button>
                                                        {{ heroicon('x-mark', 'h-5 w-5') }}
                                                    </button>
                                                </form>

                                                {{ include('@PatchlevelEventSourcingAdmin/store/detail.html.twig', {
                                                    message: message,
                                                }) }}
                                            </dialog>
                                        </div>
                                        <div class="whitespace-nowrap text-right text-sm text-gray-500">
                                            {{ message.recordedOn|date }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            </div>

        </div>
    </div>

    <script>
      document.querySelectorAll("[data-modal]").forEach(function(button) {
        button.addEventListener("click", function() {
          var dialog = document.getElementById(button.dataset.modal);
          dialog.showModal();
          dialog.querySelector("button").addEventListener("click", function() {
            dialog.close();
          });
        });
      });
    </script>

{% endblock %}

{% macro text(name, content) %}
    <div class="p-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-0">
        <dt class="text-sm font-medium leading-6 text-gray-900">{{ name }}</dt>
        <dd class="mt-1 text-sm leading-6 text-gray-500 sm:col-span-2 sm:mt-0">{{ content }}</dd>
    </div>
{% endmacro %}
